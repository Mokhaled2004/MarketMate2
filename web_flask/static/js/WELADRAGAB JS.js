// Existing fruit and vegetable products list
const fruitVegetableProducts = [
    {
        id: 12,
        image: '../static/images/images/melon.jpg',
        title: 'Watermelon',
        price: 48,
        quantity: 1
    },
    {
        id: 11,
        image: '../static/images/images/mango.jpg',
        title: 'Mango',
        price: 43,
        quantity: 1
    },
    {
        id: 10,
        image: '../static/images/images/strawberry.jpg',
        title: 'Strawberry',
        price: 33,
        quantity: 1
    },
    {
        id: 9,
        image: '../static/images/images/Eggplant.jpg',
        title: 'Eggplant',
        price: 28,
        quantity: 1
    },
    {
        id: 8,
        image: '../static/images/images/cucumber.jpg',
        title: 'Cucumber',
        price: 18,
        quantity: 1
    },
    {
        id: 7,
        image: '../static/images/images/broccoli.jpg',
        title: 'Broccoli',
        price: 38,
        quantity: 1
    },
    {
        id: 6,
        image: '../static/images/images/carrot.jpg',
        title: 'Carrot',
        price: 13,
        quantity: 1
    },
    {
        id: 5,
        image: '../static/images/images/Oranges.jpg',
        title: 'Oranges',
        price: 33,
        quantity: 1
    },
    {
        id: 4,
        image: '../static/images/images/tamato.png',
        title: 'Tomato',
        price: 28,
        quantity: 1
    },
    {
        id: 3,
        image: '../static/images/images/onion.png',
        title: 'Onion',
        price: 28,
        quantity: 1
    },
    {
        id: 2,
        image: '../static/images/images/chili.png',
        title: 'Chili',
        price: 13,
        quantity: 1
    },
    {
        id: 1,
        image: '../static/images/images/patato.png',
        title: 'Potato',
        price: 18,
        quantity: 1
    },
    {
        id: 0,
        image: '../static/images/images/apple.png',
        title: 'Apple',
        price: 23,
        quantity: 1
    }
];

const meatProducts = [
    {
        id: 32,
        image: '../static/images/images/mackerel.jpg',
        title: 'Mackerel',
        price: 243,
        quantity: 1
    },
    {
        id: 31,
        image: '../static/images/images/trout.jpg',
        title: 'Trout',
        price: 693,
        quantity: 1
    },
    {
        id: 30,
        image: '../static/images/images/tuna.jpg',
        title: 'Tuna',
        price: 393,
        quantity: 1
    },
    {
        id: 29,
        image: '../static/images/images/sausage.jpg',
        title: 'Sausage',
        price: 223,
        quantity: 1
    },
    {
        id: 28,
        image: '../static/images/images/liver.jpg',
        title: 'Liver',
        price: 343,
        quantity: 1
    },
    {
        id: 27,
        image: '../static/images/images/rabbit.jpg',
        title: 'Rabbit',
        price: 323,
        quantity: 1
    },
    {
        id: 26,
        image: '../static/images/images/duck.jpg',
        title: 'Duck',
        price: 223,
        quantity: 1
    },
    {
        id: 25,
        image: '../static/images/images/chicken.jpg',
        title: 'Chicken',
        price: 243,
        quantity: 1
    },
    {
        id: 24,
        image: '../static/images/images/goat.jpg',
        title: 'Goat',
        price: 393,
        quantity: 1
    },
    {
        id: 23,
        image: '../static/images/images/vension.jpg',
        title: 'Vension',
        price: 643,
        quantity: 1
    },
    {
        id: 22,
        image: '../static/images/images/lamb.jpg',
        title: 'Lamb',
        price: 593,
        quantity: 1
    },
    {
        id: 21,
        image: '../static/images/images/beef.jpg',
        title: 'Beef',
        price: 343,
        quantity: 1
    }
];

const bakeryProducts = [
    {
        id: 44,
        image: '../static/images/images/donut.jpg',
        title: 'Donut',
        price: 38,
        quantity: 1
    },
    {
        id: 43,
        image: '../static/images/images/applepie.jpg',
        title: 'Apple Pie',
        price: 213,
        quantity: 1
    },
    {
        id: 42,
        image: '../static/images/images/shortbread.jpg',
        title: 'Short Bread',
        price: 128,
        quantity: 1
    },
    {
        id: 41,
        image: '../static/images/images/cookies.jpg',
        title: 'Cookies',
        price: 158,
        quantity: 1
    },
    {
        id: 40,
        image: '../static/images/images/cheesecake.jpg',
        title: 'Cheese Cake',
        price: 243,
        quantity: 1
    },
    {
        id: 39,
        image: '../static/images/images/spongecake.jpg',
        title: 'Sponge Cake',
        price: 293,
        quantity: 1
    },
    {
        id: 38,
        image: '../static/images/images/turnover.jpg',
        title: 'Turnover',
        price: 63,
        quantity: 1
    },
    {
        id: 37,
        image: '../static/images/images/croissant.jpg',
        title: 'Croissant',
        price: 33,
        quantity: 1
    },
    {
        id: 36,
        image: '../static/images/images/sourdoughbread.jpg',
        title: 'Sourdough Bread',
        price: 93,
        quantity: 1
    },
    {
        id: 35,
        image: '../static/images/images/baguette.jpg',
        title: 'Baguette Bread',
        price: 63,
        quantity: 1
    },
    {
        id: 34,
        image: '../static/images/images/ryebread.jpg',
        title: 'Rye Bread',
        price: 113,
        quantity: 1
    },
    {
        id: 33,
        image: '../static/images/images/whitebread.jpg',
        title: 'White Bread',
        price: 73,
        quantity: 1
    }
];

const snacksProducts = [
    {
        id: 56,
        image: '../static/images/images/redbull.jpg',
        title: 'Redbull',
        price: 38,
        quantity: 1
    },
    {
        id: 55,
        image: '../static/images/images/soda.jpg',
        title: 'Sodas',
        price: 13,
        quantity: 1
    },
    {
        id: 54,
        image: '../static/images/images/applejuice.jpg',
        title: 'Apple Juice',
        price: 8,
        quantity: 1
    },
    {
        id: 53,
        image: '../static/images/images/orangejuice.jpg',
        title: 'Orange Juice',
        price: 8,
        quantity: 1
    },
    {
        id: 52,
        image: '../static/images/images/waterbottle.jpg',
        title: 'Water',
        price: 3,
        quantity: 1
    },
    {
        id: 51,
        image: '../static/images/images/icecream.jpg',
        title: 'Ice Cream',
        price: 28,
        quantity: 1
    },
    {
        id: 50,
        image: '../static/images/images/sweets.jpg',
        title: 'Candy',
        price: 168,
        quantity: 1
    },
    {
        id: 49,
        image: '../static/images/images/trail_mix.jpg',
        title: 'Trail Mix',
        price: 223,
        quantity: 1
    },
    {
        id: 48,
        image: '../static/images/images/crackers.jpg',
        title: 'Crackers',
        price: 18,
        quantity: 1
    },
    {
        id: 47,
        image: '../static/images/images/popcorn.jpg',
        title: 'Popcorn',
        price: 33,
        quantity: 1
    },
    {
        id: 46,
        image: '../static/images/images/pretzels.jpg',
        title: 'Pretzels',
        price: 73,
        quantity: 1
    },
    {
        id: 45,
        image: '../static/images/images/chips.jpg',
        title: 'Chips',
        price: 28,
        quantity: 1
    }
];

const dairyProducts = [
    {
        id: 63,
        image: '../static/images/images/Whipping_cream.jpeg',
        title: 'Whipping cream',
        price: 55,
        quantity: 1
    },
    {
        id: 62,
        image: '../static/images/images/Yogurt.jpeg',
        title: 'Yogurt',
        price: 45,
        quantity: 1
    },
    {
        id: 61,
        image: '../static/images/images/Butter.jpeg',
        title: 'Butter',
        price: 70,
        quantity: 1
    },
    {
        id: 60,
        image: '../static/images/images/Mozzarella.jpeg',
        title: 'Mozzarella Cheese',
        price: 55,
        quantity: 1
    },
    {
        id: 59,
        image: '../static/images/images/Cheddar.jpeg',
        title: 'Cheddar Cheese',
        price: 50,
        quantity: 1
    },
    {
        id: 58,
        image: '../static/images/images/Feta.jpeg',
        title: 'Feta Cheese',
        price: 40,
        quantity: 1
    },
    {
        id: 57,
        image: '../static/images/images/Milk.jpeg',
        title: 'Milk',
        price: 60,
        quantity: 1
    },
    {
        id: 65,
        image: '../static/images/images/Cottage_Cheese.jpeg',
        title: 'Cottage Cheese',
        price: 40,
        quantity: 1
    },
    {
        id: 64,
        image: '../static/images/images/Ghee.jpeg',
        title: 'Ghee',
        price: 65,
        quantity: 1
    }
];

const babyProducts = [
    {
        id: 71,
        image: '../static/images/Diapers.jpg',
        title: 'Pampers Baby Pants',
        price: 570,
        quantity: 1
    },
    {
        id: 70,
        image: '../static/images/Baby_Powder.jpg',
        title: "Johnson's Baby Powder",
        price: 145,
        quantity: 1
    },
    {
        id: 69,
        image: '../static/images/Baby_Shampoo.jpg',
        title: 'Himalaya Baby Shampoo',
        price: 350,
        quantity: 1
    },
    {
        id: 68,
        image: '../static/images/Moisturizer.jpg',
        title: 'Moisturizer',
        price: 490,
        quantity: 1
    },
    {
        id: 67,
        image: '../static/images/Baby_Wipes.jpg',
        title: "Little's Baby Wipes",
        price: 90,
        quantity: 1
    },
    {
        id: 66,
        image: '../static/images/johnsonoil.jpg',
        title: "Johnson's Baby Oil",
        price: 370,
        quantity: 1
    }
];

const medicineProducts = [
    {
        id: 80,
        image: '../static/images/images/motilium.jpg',
        title: 'Motilium',
        price: 65,
        quantity: 1
    },
    {
        id: 79,
        image: '../static/images/images/aspirin.jpg',
        title: 'Aspirin',
        price: 90,
        quantity: 1
    },
    {
        id: 78,
        image: '../static/images/images/feroglobin.png',
        title: 'Feroglobin',
        price: 65,
        quantity: 1
    },
    {
        id: 77,
        image: '../static/images/images/otrivin.png',
        title: 'Otrivin',
        price: 65,
        quantity: 1
    },
    {
        id: 76,
        image: '../static/images/images/osteocare.jpg',
        title: 'Osteocare',
        price: 90,
        quantity: 1
    },
    {
        id: 75,
        image: '../static/images/images/cataflam.jpg',
        title: 'Cataflam',
        price: 50,
        quantity: 1
    },
    {
        id: 74,
        image: '../static/images/images/zyrtec.jpg',
        title: 'Zyrtec',
        price: 55,
        quantity: 1
    },
    {
        id: 73,
        image: '../static/images/images/bruffen.jpg',
        title: 'Bruffen',
        price: 60,
        quantity: 1
    },
    {
        id: 72,
        image: '../static/images/images/panadol.jpg',
        title: 'Panadol',
        price: 80,
        quantity: 1
    }
];

const PopularPackges = [
    {
        id: 88,
        image: '../static/images/images/pack6.jpeg',
        title: 'Snack Attack Bundle',
        price: 120,
        quantity: 1
    },
    {
        id: 87,
        image: '../static/images/images/pack5.jpeg',
        title: 'Baker Delight Box',
        price: 270,
        quantity: 1
    },
    {
        id: 86,
        image: '../static/images/images/pack4.jpeg',
        title: 'Baby Essentials Bundle',
        price: 50,
        quantity: 1
    },
    {
        id: 85,
        image: '../static/images/images/pack3.jpeg',
        title: 'Butcher Choice Bundle',
        price: 55,
        quantity: 1
    },
    {
        id: 84,
        image: '../static/images/images/pack2.jpeg',
        title: 'Health Essentials Kit',
        price: 520,
        quantity: 1
    },
    {
        id: 83,
        image: '../static/images/images/pack1.png',
        title: 'Green Garden Bundle',
        price: 370,
        quantity: 1
    }
];


// Merge fruitVegetableProducts and meatProducts into a single categories array
const categories = [...fruitVegetableProducts, ...meatProducts, ...bakeryProducts, ...snacksProducts, ...dairyProducts, ...babyProducts, ...medicineProducts, ...PopularPackges];
let i = 0;
// Function to switch between displaying fruit/vegetable and meat products
function switchCategory(category) {
    if (category === 'fruitVegetableProducts') {
        document.getElementById('categoryTitle').textContent = 'Fruits & Vegetables';
    } else if (category === 'meatProducts') {
        document.getElementById('categoryTitle').textContent = 'Meat';
    }
    else if (category === 'bakeryProducts') {
        document.getElementById('categoryTitle').textContent = 'Bakery Products';
    }
    else if (category === 'snacksProducts') {
        document.getElementById('categoryTitle').textContent = 'SnacksProducts';
    }
    else if (category === 'dairyProducts') {
        document.getElementById('categoryTitle').textContent = 'Dairy Products';
    }
    else if (category === 'babyProducts') {
        document.getElementById('categoryTitle').textContent = 'Baby Products';
    }
    else if (category === 'medicineProducts') {
        document.getElementById('categoryTitle').textContent = 'Medicine Products';
    }
    else if (category === 'PopularPackges') {
        document.getElementById('categoryTitle').textContent = 'Popular Packges';
    }
    
    displayProducts(category);
}
// Initial display of products (default: fruit/vegetable products)
displayProducts('fruitVegetableProducts');
// Function to display products based on the selected category
function displayProducts(category) {
    let products;
    if (category === 'fruitVegetableProducts') {
        products = fruitVegetableProducts;
    } else if (category === 'meatProducts') {
        products = meatProducts;
    } else if (category === 'bakeryProducts') {
        products = bakeryProducts;
    } else if (category === 'snacksProducts') {
        products = snacksProducts;
    }else if (category === 'dairyProducts') {
        products = dairyProducts;
    }else if(category === 'babyProducts') {
        products = babyProducts;
    }else if(category === 'medicineProducts') {
        products = medicineProducts;
    }else if(category === 'PopularPackges') {
        products = PopularPackges;
    }else {
        products = [];
    }
    document.getElementById('root').innerHTML = products.map((item) => {
        var { image, title, price } = item;
        return (
            `<div class='box'>
                <div class='img-box'>
                    <img class='images' src=${image}></img>
                </div>
                <div class='bottom'>
                    <p>${title}</p>
                    <h2>LE ${price}.00</h2>
                    <button onclick='addtocart(${item.id})'>Add to cart</button>
                </div>
            </div>`
        );
    }).join('');
}
var cart = []; // This holds data sent to Flask
var dcart = []; // This holds data for display only

function addtocart(productId) {
    const selectedProduct = categories.find(item => item.id === productId);
    const itemIndex = cart.findIndex(item => item.id === productId);
    
    if (itemIndex > -1) {
        cart[itemIndex].quantity += 1;
    } else {
        // Add the product details to the cart
        const { id, title, image, price, quantity } = selectedProduct;
        cart.push({ id, title, image, price, quantity });
    }
    
    // Update the display-only cart (dcart)
    const displayItemIndex = dcart.findIndex(item => item.id === productId);
    if (displayItemIndex > -1) {
        dcart[displayItemIndex].quantity += 1;
    } else {
        dcart.push({ ...selectedProduct, quantity: 1 });
    }
    
    // Update the cart display
    displaycart();
    
    // Prepare cart data for Flask
    const cartDataForServer = cart.map(item => ({
        title: item.title,
        image: item.image,
        price: item.price,
        quantity: item.quantity
    }));
    
    // Send cart data to Flask
    fetch('/process_cart', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({ cart: cartDataForServer }), // Pass processed cart data
    })
    .then(response => {
        if (!response.ok) {
            throw new Error('Failed to send cart data to server');
        }
        return response.json();
    })
    .then(data => {
        console.log(data); // Optional: Handle success response from server
        
        // Clear the cart after successfully sending data to server
        cart.length = 0;
        displaycart(); // Update cart display to show it's empty
    })
    .catch(error => {
        console.error('Error:', error); // Optional: Handle error case
    });
}

function delElement(a) {
    const productTitle = dcart[a].title;

    // Send DELETE request to Flask server to remove item from storage
    fetch(`/remove_item_by_title/${encodeURIComponent(productTitle)}`, {
        method: 'DELETE',
        headers: {
            'Content-Type': 'application/json',
        }
    })
    .then(response => response.json())
    .then(data => {
        if (data.error) {
            console.error('Error:', data.error);
        } else {
            // Update the display-only cart (dcart) based on server response
            if (dcart[a].quantity > 1) {
                dcart[a].quantity -= 1;
            } else {
                dcart.splice(a, 1);
            }

            // Update the cart display
            displaycart();
        }
    })
    .catch(error => {
        console.error('Error:', error); // Optional: Handle error case
    });
}



function displaycart() {
    let total = 0;
    document.getElementById("count").innerHTML = dcart.length;

    if (dcart.length === 0) {
        document.getElementById('cartItem').innerHTML = "Your cart is empty";
        document.getElementById("total").innerHTML = "LE " + 0 + ".00";
    } else {
        // Calculate the total price
        total = dcart.reduce((acc, item) => acc + (item.price * item.quantity), 0);
        document.getElementById("total").innerHTML = "LE " + total + ".00";

        // Display cart items on the client side
        document.getElementById("cartItem").innerHTML = dcart.map((item, index) => {
            return (
                `<div class='cart-item'>
                    <div class='row-img'>
                        <img class='rowimg' src=${item.image}>
                    </div>
                    <p style='font-size:12px;'>${item.title}</p>
                    <p style='font-size:12px;'>Quantity: ${item.quantity}</p>
                    <h2 style='font-size: 15px;'>LE ${item.price * item.quantity}.00</h2>
                    <i class='fa-solid fa-trash' onclick='delElement(${index})'></i>
                </div>`
            );
        }).join('');
    }
}

// Assuming you have included this script at the end of your HTML body or use window.onload or DOMContentLoaded event

// script.js

document.addEventListener('DOMContentLoaded', function() {
    // Select the 'Proceed to Checkout' button
    const checkoutButton = document.getElementById('checkoutButton');

    if (checkoutButton) {
        checkoutButton.addEventListener('click', function(event) {
            event.preventDefault(); // Prevent default action of anchor tag

            // Fetch cart data or use existing data from your page
            const cartData = JSON.parse(localStorage.getItem('cart')) || [];

            // Prepare payload for POST request
            const payload = {
                cart: cartData
            };

            // Send POST request to /checkout endpoint
            fetch('/checkout', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(payload)
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                return response.json();
            })
            .then(data => {
                // Handle successful response
                console.log(data.message); // Log success message
                // Optionally, redirect to checkout details page or handle UI updates
            })
            .catch(error => {
                // Handle errors
                console.error('Error:', error);
                // Optionally, display an error message to the user
            });
        });
    }
});
//commented

document.addEventListener('DOMContentLoaded', function() {
    // Select the search form and input
    const searchForm = document.getElementById('search-boxx');
    const searchInput = document.getElementById('search-input');

    // Add an event listener to the search form
    searchForm.addEventListener('submit', function(event) {
        event.preventDefault(); // Prevent form submission
        const query = searchInput.value.toLowerCase(); // Get the search query
        filterProducts(query); // Call the filter function
    });

    // Function to filter products based on the search query
    function filterProducts(query) {
        // Filter the categories array based on the query
        const filteredProducts = categories.filter(product => product.title.toLowerCase().includes(query));
        displayFilteredProducts(filteredProducts); // Display the filtered products
    }

    // Function to display filtered products
    function displayFilteredProducts(products) {
        document.getElementById('root').innerHTML = products.map((item) => {
            var { image, title, price } = item;
            return (
                `<div class='box'>
                    <div class='img-box'>
                        <img class='images' src=${image}></img>
                    </div>
                    <div class='bottom'>
                        <p>${title}</p>
                        <h2>LE ${price}.00</h2>
                        <button onclick='addtocart(${item.id})'>Add to cart</button>
                    </div>
                </div>`
            );
        }).join('');
    }

});

function changeText(link) {
    link.innerHTML = 'Order Added &#10004;'; 
    link.classList.add('pressed');
}


